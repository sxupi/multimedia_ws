<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>Radio Control</title>
    <!-- W3.CSS for quick styling -->
    <link
      rel="stylesheet"
      href="https://www.w3schools.com/w3css/4/w3.css"
    />
  </head>
  <body class="w3-light-grey">
    <div class="w3-container" style="max-width: 480px; margin-top: 40px;">
      <div class="w3-card w3-white w3-padding">
        <h2 class="w3-center">Radio Control</h2>

        <!-- Command buttons -->
        <div class="w3-center w3-margin-top">
          <button
            class="w3-button w3-blue w3-margin-small"
            onclick="sendCommand('PLAY_STOP')"
          >
            PLAY / STOP
          </button>

          <button
            class="w3-button w3-teal w3-margin-small"
            onclick="sendCommand('SWITCH')"
          >
            SWITCH
          </button>
        </div>

        <div class="w3-center">
          <button
            class="w3-button w3-green w3-margin-small"
            onclick="sendCommand('PREV')"
          >
            PREV
          </button>

          <button
            class="w3-button w3-green w3-margin-small"
            onclick="sendCommand('NEXT')"
          >
            NEXT
          </button>
        </div>

        <!-- Volume slider -->
        <div class="w3-margin-top">
          <label class="w3-text-grey">
            Volume: <strong id="volume-value">50</strong>
          </label>
          <input
            class="w3-input"
            type="range"
            min="0"
            max="100"
            value="50"
            id="volume-slider"
            oninput="updateVolumeLabel()"
          />

          <button
            class="w3-button w3-purple w3-margin-top"
            onclick="sendVolume()"
          >
            Set Volume
          </button>
        </div>

        <!-- Status -->
        <div class="w3-margin-top">
          <div id="status" class="w3-small w3-text-grey"></div>

          <div
            id="response-panel"
            class="w3-panel w3-pale-green w3-border"
            style="display: none; margin-top: 10px;"
          >
            <p class="w3-small">Last response:</p>
            <pre
              id="response-text"
              style="white-space: pre-wrap; word-wrap: break-word;"
            ></pre>
          </div>

          <div
            id="error-panel"
            class="w3-panel w3-pale-red w3-border"
            style="display: none; margin-top: 10px;"
          >
            <p class="w3-small">Error:</p>
            <p id="error-text"></p>
          </div>
        </div>
      </div>
    </div>

    <script>
      // Adjust this if the API is on another machine/port
      const API_BASE = "http://192.168.178.58:8000";

      function updateVolumeLabel() {
        const slider = document.getElementById("volume-slider");
        const label = document.getElementById("volume-value");
        label.textContent = slider.value;
      }

      function setStatus(text) {
        document.getElementById("status").textContent = text || "";
      }

      function showResponse(data) {
        const panel = document.getElementById("response-panel");
        const text = document.getElementById("response-text");
        panel.style.display = "block";
        text.textContent = JSON.stringify(data, null, 2);
      }

      function showError(err) {
        const panel = document.getElementById("error-panel");
        const text = document.getElementById("error-text");
        panel.style.display = "block";
        text.textContent = err;
      }

      function clearMessages() {
        document.getElementById("response-panel").style.display = "none";
        document.getElementById("error-panel").style.display = "none";
      }

      async function sendCommand(command, value) {
        clearMessages();
        setStatus("Sending command: " + command + "...");

        const payload = { command };
        if (command === "SET_VOLUME") {
          payload.value = value;
        }

        try {
          const res = await fetch(API_BASE + "/command", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(payload),
          });

          const data = await res.json();

          if (!res.ok) {
            const detail = data.detail || "Unknown error";
            showError(detail);
            setStatus("Error while sending command.");
          } else {
            showResponse(data);
            setStatus("Command sent successfully.");
          }
        } catch (err) {
          showError(String(err));
          setStatus("Network error.");
        }
      }

      function sendVolume() {
        const slider = document.getElementById("volume-slider");
        const volume = Number(slider.value);
        sendCommand("SET_VOLUME", volume);
      }
    </script>
  </body>
</html>
